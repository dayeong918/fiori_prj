sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/core/Fragment","sap/m/MessageBox","sap/ui/model/odata/v2/ODataModel","sap/ui/core/format/NumberFormat"],function(e,t,o,i,n,a,s){"use strict";return e.extend("zsalesorderfi.controller.Main",{onInit:function(e){this.oModel=new t;this.oModel.setData({badgeMin:"1",badgeMax:"9999",badgeCurrent:1,buttonText:"Button with Badge",buttonIcon:"sap-icon://cart",buttonType:"Default",buttonWithIcon:true,buttonWithText:true});this.getView().setModel(this.oModel,"a");this.jsonModel=this.getView().setModel(new t,"json");this.aStore=[];this.aStore_obj=[];this.price=[];this.odataItem;this.oLabel=this.byId("ButtonLabel");this.oButton=this.byId("BadgedButton");this.oMin=this.byId("MinInput");this.oMax=this.byId("MaxInput");this.oCurrent=this.byId("CurrentValue");this.oLabelCheckBox=this.byId("LabelCheckBox")},currentChangeHandler:function(){var e=this.oCurrent.getValue(),t=this.oButton.getBadgeCustomData(),o=e.toString();if(!t){return}t.setValue(o)},cartPress:function(e){var t=e.getSource(),o=this.getView();if(!this._pPopover){this._pPopover=i.load({id:o.getId(),name:"zsalesorderfi.view.fragment.Popover",controller:this}).then(function(e){o.addDependent(e);e.bindElement("json");console.log(e);return e})}this._pPopover.then(function(e){e.openBy(t)})},soPress:function(){var e=this.byId("Dialog");if(e){e.open();return}else{this.loadFragment({name:"zsalesorderfi.view.fragment.CustomerDialog"}).then(function(e){e.open()},this)}},_handleMessageBoxOpen:function(e,t){n[t](e,{actions:[n.Action.YES,n.Action.NO],onClose:function(e){if(e===n.Action.YES){this.handleDamdaSubmit()}}.bind(this)})},leWizardCancel:function(){this.byId("myPopover").close()},_handleMessageBoxOpen2:function(e,t,o){sap.m.MessageBox.show(e,t,"확인",[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],function(e){if(o&&typeof o==="function"){o(e)}})},handleDamdaSubmit:function(){var e=this.getView().getModel();var t=this.getView().getModel("json").getData();this._handleMessageBoxOpen2("주문오더를 생성하시겠습니까?","confirm",function(o){if(o===n.Action.OK){if(this.aStore.length==0){n.warning("주문하실 아이템을 선택해주세요.")}else{var i={OrdDocNum:"",SD_ORD_I:[]};debugger;for(var a=0;a<t.length;a++){var s=Number(t[a].Price)*t[a].cnt/100;i.SD_ORD_I.push({OrdDocNum:"",SkuId:t[a].SkuId,Batch:t[a].Batch,WhId:"2000",OrdQty:t[a].cnt,TotalPrice:String(s),Currency:"KRW",StfUnit:"EA",OutQty:t[a].cnt});console.log(i)}this.getView().getModel().create("/SD_ORD_HSet",i,{success:function(t){console.log("성공");console.log(t);this.getView().getModel("json").setData();this.getView().getModel("a").setProperty("/clickCount",0);e.refresh(true,true);this.aStore_obj.forEach(function(e){e.setValue(0)});this.aStore_obj=[];this.aStore=[];n.success("주문을 생성하였습니다.")}.bind(this),error:function(e){console.log("실패");console.log(e)}})}}}.bind(this))},handleCloseButton:function(e){this.byId("myPopover").close()},handleDelete:function(e){var t=e.getParameter("listItem");var o=e.getParameter("listItem").getParent().getItems();if(o.length<=1){return}for(var i=0;i<o.length;i++){if(o[i].getTitle()===t.getTitle()){o.splice(i,1);this.calcTotal();this.model.updateBindings();break}}},onValueChange:function(e){var t=this.getOwnerComponent().getModel();var o=this.getView().getModel("json");var i=e.getParameter("value");var n=this.getView().getModel().getObject(e.getSource().getBindingContext().getPath()).InvQty;var a=this.getView().getModel().getObject(e.getSource().getBindingContext().getPath());console.log(t);if(i==0){e.getSource().setValueState(sap.ui.core.ValueState.none);e.getSource().setValueStateText("품절입니다.")}else if(i>n){e.getSource().setValueState(sap.ui.core.ValueState.Error);e.getSource().setValueStateText("구매 수량이 현재 재고량보다 초과되었습니다.")}else if(i<=n){e.getSource().setValueState(sap.ui.core.ValueState.Success)}var s=this.getView().getModel().getObject(e.getSource().getBindingContext().getPath());var r,u;var c=this.aStore.some(function(e){if(e.SkuId===s.SkuId&&e.Batch===s.Batch){r=e.SkuId;u=e.Batch;return true}return false});this.aStore_obj.push(e.getSource());if(c){if(i===0){if(i===0){var l=this.aStore.findIndex(function(e){return e.SkuId===r&&e.Batch===u});if(l>-1){this.aStore.splice(l,1);o.setData(this.aStore)}}}this.aStore=this.aStore.map(function(t){if(t.SkuId===r&&t.Batch===u){t.cnt=i;t.OrdQty=e.getParameters().value;debugger}return t})}else{s.cnt=i;this.aStore.push(s)}o.setData(this.aStore);this.getView().getModel("a").setProperty("/clickCount",this.aStore.length);console.log(this.getView().getModel("a").getProperty("/clickCount"));this.getView().getModel("a").setProperty("/clickCount",this.aStore.length);console.log(this.getView().getModel("a").getProperty("/clickCount"))},fnSectionChange:function(e){this.byId("listPage").setSelectedSection(this.byId(e))}})});
//# sourceMappingURL=Main.controller.js.map